#!/usr/bin/python3
"""X Utilities."""
import argparse
import common
import subprocess
import os


def _is_running(obj, command="pidof"):
    """Check if a process is running."""
    return subprocess.call([command, obj]) == 0


def _daemon(env):
    """Daemon mode."""
    import time
    locking = os.path.join(env.HOME_BIN, "locking")
    dunst_conf = os.path.join(env.HOME, ".config/dunst")
    status = "status"
    status_bin = os.path.join(env.HOME_BIN, "status")
    while True:
        if not _is_running("xautolock"):
            subprocess.Popen(["xautolock",
                              "-time",
                              "5",
                              "-locker",
                              "'" + locking + " lock'"])
        if not _is_running("dunst"):
            subprocess.Popen(["dunst",
                              "-config",
                              dunst_conf])
        if not _is_running(status, command="pgrep"):
            subprocess.Popen([status_bin])
        time.sleep(10)


def main():
    """Program entry."""
    parser = argparse.ArgumentParser()
    parser.add_argument("command")
    args = parser.parse_args()
    env = common.read_env()
    if args.command == "system":
        _daemon(env)


if __name__ == "__main__":
    main()

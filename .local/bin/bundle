#!/usr/bin/perl
use strict;
use warnings;
use Cwd;

my $type = shift @ARGV;
my $name = shift @ARGV;
my $vers = shift @ARGV;

my $def = $ENV{"HOME"} . "/.local/lib/dockerfiles/$type.Dockerfile";

die "invalid type" if ! -e $def;
die "name required" if ! $name;
die "version required" if ! $vers;

my $folder = "";
if ( $type eq "deb" ) {
    $folder = "debian";
}
elsif ( $type eq "rpm" ) {
    $folder = "rpmbuild";
}

die "no packaging folder found" if ! -d $folder;

my $cwd = getcwd();
system("cp $def $cwd/Dockerfile");
system("podman build --tag $type:$name-$type-$vers -f ./Dockerfile --volume $cwd:/$type --build-arg OBJECT_VERSION=$vers --build-arg OBJECT_NAME=$name");
system("rm -f $cwd/Dockerfile");

#!/bin/bash
source $HOME/.config/home/common

_weechat() {
    WEECHAT=$HOME/.weechat/python/
    for a in autosort buffer_autoset; do
        echo "pulling $a"
        curl -s https://www.weechat.org/files/scripts/$a.py > ${WEECHAT}$a.py
    done
}

_create-list() {
    local idx chr cnt line musicfile
    musicfile="${PERM_CONFIGS}music"
    idx=1
    cnt=$(cat $musicfile | wc -l)
    while [ $idx -le $cnt ]; do
        line=$(cat $musicfile | head -n $idx | tail -n 1)
        chr=$(echo "$line" | cut -c1 | tr '[:lower:]' '[:upper:]')"/"
        echo "$chr"
        echo "$chr$line/***"
        idx=$((idx+1))
    done
}

_music() { 
    tmpfile=$USER_TMP/music.$(date +%s)
    _create-list | sort -u > $tmpfile
    rsync -av --include-from $tmpfile --exclude="*" -e "ssh" "$BASE_SERVER:store/Home/Media/Music/" $HOME_CACHE/music --delete-after --delete-excluded
}

if [ -z "$1" ]; then
    echo "no command given"
    exit 1
fi
case "$1" in
    "weechat")
        _weechat
        ;;
    "music")
        _music
        ;;
    *)
        echo "unknown command: $1"
        ;;
esac

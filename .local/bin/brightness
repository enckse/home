#!/usr/bin/perl

my $command = "mid";
$command = shift @ARGV if (@ARGV);

sub current {
    my $value =
`xrandr --current --verbose | grep Brightness | cut -d ":" -f 2 | head -n 1 | awk '{ print \$1 * 100 }'`;
    chomp $value;
    return 0 + $value;
}

if ( $command eq "status" ) {
    print current;
    exit 0;
}

if ( $command eq "up" or $command eq "down" ) {
    my $cur  = current;
    my $mode = "mid";
    if ( $command eq "up" ) {
        $mode = "high" if $cur >= 50;
    }
    else {
        $mode = "low" if $cur <= 95;
    }
    system("brightness $mode");
    exit 0;
}
my $value = "0.9";
$value = "0.3" if ( $command eq "low" );
$value = "1.0" if ( $command eq "high" );

for ( (`xrandr | grep " connected" | cut -d " " -f 1`) ) {
    chomp;
    system("xrandr --output $_ --brightness $value");
}

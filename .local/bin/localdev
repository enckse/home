#!/usr/bin/perl
use strict;
use warnings;

my $command = shift @ARGV;
my $script   = $ENV{"HOME"} . "/.local/bin/localdev";
my $localdev = "/opt/localdev/";

if ( !$command ) {
    while (1) {
        system("perl $script dl");
        system("sleep 5");
    }
    exit 0;
}

if ( $command eq "dl" ) {
    if ( -d $localdev ) {
        system("perl $script dlbg &");
    }
}
elsif ( $command eq "dlbg" ) {
    my $cache = "/tmp/localdev/dl/";
    system("mkdir -p $cache");
    my $file = `date +%Y%m%d`;
    chomp $file;
    $file = $cache . $file;
    if ( !-e $file ) {
        my $dl = $localdev . "dl/";
        if ( system("wsw online") == 0 ) {
            system("cd $dl && rm -rf *");
            system(
"cd $dl && wget -r --no-parent http://novel.voidedtech.com/repo >> $file 2>&1"
            );
        }
    }
}

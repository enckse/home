#!/bin/bash
find ~/store/personal/mirror/tasks/Trash -type f -mtime +30 -exec rm {} \;
CMD="$1"
if [ -z "$CMD" ]; then
    CMD="show"
fi

_body() {
    mapfile body
    for line in "${body[@]}"; do
       echo "$line"
    done
}

case "$CMD" in
    "show")
        /usr/bin/mutt -F ~/.mutt/tasks.muttrc
        ;;
    "null")
        ;;
    "add")
        read -p "subject: " subj
        echo "body:"
        tmpf=$(mktemp)
        _body | grep -v "^$" >> $tmpf
        python ~/.local/lib/inbox.py --maildir ~/store/personal/mirror/tasks/INBOX/ \
                                     --subject "$subj" \
                                     --input $tmpf \
                                     --plaintext
        ;;
esac

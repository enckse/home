#!/bin/bash
## various points
HOME_BIN=$HOME/.local/bin
HOME_XDG=$HOME/.config/
HOME_SRC=$HOME/.local/src
HOME_SRC_GO=${HOME_SRC}/go/
HOME_EXT=$HOME/.bin/

# cache files
HOME_CACHE=$HOME/.cache/home/
USER_TMP=${HOME_CACHE}tmp/

# perm/store
PERM_LOCATION=${HOME}/store/
PERSONAL_LOC=${PERM_LOCATION}personal/
HOME_STORE=${PERSONAL_LOC}documents/
PERM_CONFIGS=${HOME_STORE}configs/
PRIV_PATH=${PERSONAL_LOC}private/
PERM_PASS=${PERM_LOCATION}pass/
PERSONAL_NOTES="${PERSONAL_LOC}notebook@localhost"

# files
SSH_AUTH_TMP=/tmp/ssh-auth.sock
PRIV_CONF=${PERM_CONFIGS}priv.aliases
XDG_USER_CONFIG=${HOME_XDG}user-dirs.dirs
JOURNALS=${USER_TMP}journal

# debian
DEB_SIGN_KEY=031E9E4B09CFD8D3F0ED35025109CDF607B5BB04

export OPENSC_CONF="$HOME/.config/opensc.conf"

_exports() {
    source $PRIV_CONF
    source ${XDG_USER_CONFIG}
    for f in HOME_BIN \
             USER_TMP \
             PERSONAL_LOC \
             XDG_DOWNLOAD_DIR \
             PERM_CONFIGS \
             PERM_LOCATION \
             TOTP_PASS \
             HOME_XDG \
             PRIV_PATH \
             PERM_PASS \
             SSH_AUTH_TMP \
             ZIP_PASS \
             ZIP_MAIL \
             HOME_STORE \
             PERSONAL_NOTES \
             PRIV_CONF \
             DEB_SIGN_KEY \
             JOURNALS; do
        echo "$f=${!f}"
    done
}

_totp_pass() {
    source $PRIV_CONF
    echo $PERM_PASS/$TOTP_PASS
}

_setup() {
    local xsess
    echo "user init "$(date +%Y-%m-%d-%H-%M-%S)

    # cleanup xsession errors
    xsess=$HOME/.xsession-errors
    cat $xsess >> ${USER_TMP}xsession.$(date +%Y-%m-%d)
    echo > $xsess
    $HOME_BIN/startup >> $JOURNALS
}

_init() {
    _setup >> ${USER_TMP}userinit.$(date +%Y-%m-%d)
}

_nohup_cmd() {
    local l=/usr/bin/$1
    pgrep $l > /dev/null
    if [ $? -ne 0 ]; then
        nohup $l "${@:2}" >/dev/null 2>&1 &
        sleep 0.25
    fi
}

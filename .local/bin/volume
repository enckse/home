#!/usr/bin/perl
use strict;
use warnings;

sub muted {
    return system("ponymix is-muted") == 0;
}

sub current {
    return 0 if muted;
    my $volume = `ponymix get-volume`;
    chomp $volume;
    return $volume;
}

sub setvol {
    my $vol = shift @ARGV;
    system("ponymix set-volume $vol");
}

my $cmd = "status";
if (@ARGV) {
    $cmd = shift @ARGV;
}

if ( $cmd eq "status" ) {
    print current;
    exit 0;
}
elsif ( $cmd eq "mute" or $cmd eq "togglemute" ) {
    my $action = "mute";
    if ( $cmd eq "togglemute" ) {
        $action = "toggle";
    }
    system("ponymix $action");
}
elsif ( $cmd eq "inc" or $cmd eq "dec" ) {
    my $cur = current;
    if ( $cmd eq "inc" ) {
        if ( $cur >= 100 ) {
            exit 0;
        }
        $cur = $cur + 10;
    }
    else {
        if ( $cur <= 0 ) {
            exit 0;
        }
        $cur = $cur - 10;
    }
    system("ponymix set-volume $cur > /dev/null");
}

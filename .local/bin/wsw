#!/bin/bash
source $HOME/.config/home/common
NETWORKS=${HOME_STORE}networks/
LIST="list"
ADAPTERS="wlp58s0 enp0s31f6"
NETWORK_FILE=/tmp/network

_networks() {
    for f in $(find $NETWORKS -type f); do
        basename $f
    done
}

_iplink() {
    ip link set $1 $2
    echo "settings $1 -> $2"
}

_change() {
    local filename
    filename="$NETWORKS/$1"
    if [ ! -e "$filename" ]; then
        echo "$1 is not valid"
        exit 1
    fi    
    for a in $(echo "$ADAPTER"); do
        ip link set $a "down"
    done
    pkill wpa_supplicant
    devices=$(echo "$1" | cut -d "." -f 2)
    flags=""
    echo "$1" | grep -q "^wired."
    if [ $? -eq 0 ]; then
        flags="-D wired"
    fi
    /bin/bash -c "/usr/bin/wpa_supplicant -c $filename -i $device $flags"
}

cmd=$1
if [ ! -z "$cmd" ]; then
    if [[ "$cmd" == "$LIST" ]]; then
        _networks
        exit 0
    fi
fi
if [ ! -e "$NETWORK_FILE" ]; then
    echo "no network file"
    exit 1
fi
_change $(cat $NETWORK_FILE)

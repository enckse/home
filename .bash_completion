#!/bin/bash
_email() {
    local cur
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        COMPREPLY=( $(compgen -W "search" -- $cur) )
    fi
}

complete -F _email email

_totp() {
    local opts cur
    opts=$(totp _list_)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _totp totp

_wsw() {
    local opts cur
    opts=$(wsw --mode list)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "reload $opts" -- $cur) )
}

complete -F _wsw wsw

_manage() {
    local cur
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        COMPREPLY=( $(compgen -W "music history-dryrun history-purge git-update-store" -- $cur) )
    fi
}

complete -F _manage manage

_geanyproj() {
    local cur opts
    if [ $COMP_CWORD -eq 1 ]; then
        source $HOME/.local/bin/conf
        cur=${COMP_WORDS[COMP_CWORD]}
        opts=""
        for f in $(find $GEANY_PROJ -type f -name "*.geany"); do
            basepath=$(cat $f | grep "base_path=" | cut -d "=" -f 2 | head -n 1)
            if [ -d "$basepath" ]; then
                opts="$opts $f"
            fi
        done
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    fi
}

complete -F _geanyproj geany_project

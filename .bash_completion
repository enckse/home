#!/bin/bash
function _simple_autocomplete()
{
    local cur opts 
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        opts=$($1 | grep -v "^$" | cut -d " " -f 5)
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    fi
}

_machinectl-nspawn()
{
    local cur opts cmd
    cmd=""
    if [ $COMP_CWORD -eq 1 ]; then
        cmd='cat /home/enck/.bin/makefile.nspawn | grep "^[a-z]" | grep ":" | cut -d ":" -f 1 | grep -v -E "running|root|empty|instance" | sort | uniq'
    else
        cmd='/usr/bin/machinectl list-images | grep -v "NAME" | grep -v "^$" | cut -d " " -f 1 | head -n -1'
    fi
    if [ ! -z "$cmd" ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        opts=$(eval $cmd)
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    fi
}
complete -F _machinectl-nspawn machinectl-nspawn

_mounting()
{
    _simple_autocomplete "mounting"
}
complete -F _mounting mounting

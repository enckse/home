#!/bin/bash
_totp() {
    local opts cur
    opts=$(totp list)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _totp totp

_wsw() {
    local opts cur
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        opts=$(wsw help)
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    else
        if [ $COMP_CWORD -eq 2 ]; then
            cur=${COMP_WORDS[1]}
            if [[ "$cur" == "change" ]]; then
                opts=$(wsw list)
                COMPREPLY=( $(compgen -W "$opts" -- ${COMP_WORDS[COMP_CWORD]}) )
            fi
        fi
    fi
}

complete -F _wsw wsw

_wiki() {
    local cur opts
    cur=${COMP_WORDS[COMP_CWORD]}
    opts=$(find ~/store/personal/mirror/notebook -type f -name "*.md" | sed "s#/home/enck/store/personal/mirror/notebook/##g")
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _wiki wiki

_pkgl() {
    local cur opts
    cur=${COMP_WORDS[COMP_CWORD]}
    if [ $COMP_CWORD -eq 1 ]; then
        opts=$(pkgl help)
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    else
        if [ $COMP_CWORD -eq 2 ]; then
            cur=${COMP_WORDS[1]}
            opts=""
            case "$cur" in
                "binrel")
                    opts="pacman binaries"
                    ;;
                "repoadd")
                    opts=$(ls | grep ".pkg.tar.zst")
                    ;;
                *)
                    ;;
            esac
            if [ ! -z "$opts" ]; then
                 COMPREPLY=( $(compgen -W "$opts" -- ${COMP_WORDS[COMP_CWORD]}) )
            fi
        fi
    fi
}

complete -F _pkgl pkgl

_backup() {
    local cur
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "status clear" -- $cur) )
}

complete -F _backup backup

_sys() {
    local cur opts
    cur=${COMP_WORDS[COMP_CWORD]}
    if [ $COMP_CWORD -eq 1 ]; then
        opts="chroots mail history"
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    fi
}

complete -F _sys sys

_pcm() {
    local cur opts
    cur=${COMP_WORDS[COMP_CWORD]}
    if [ $COMP_CWORD -eq 1 ]; then
        opts="files contains packages orphans"
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    fi
}

complete -F _pcm pcm

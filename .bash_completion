#!/bin/bash
_email() {
    local cur
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        COMPREPLY=( $(compgen -W "search" -- $cur) )
    fi
}

complete -F _email email

_totp() {
    local opts cur
    source $HOME/.local/bin/conf
    opts=$(${HOME_EXT}totp --list --pass $(_totp_pass))
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _totp totp

_wsw() {
    local opts cur
    opts=$(wsw --mode list)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "reload $opts" -- $cur) )
}

complete -F _wsw wsw

_manage() {
    source $HOME/.local/bin/conf
    local cur opts
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        COMPREPLY=( $(compgen -W "music schroots history git" -- $cur) )
    else
        if [ $COMP_CWORD -eq 2 ]; then
            cur=${COMP_WORDS[1]}
            case "$cur" in
                "history")
                    opts="purge dryrun"
                    ;;
                "git")
                    opts="all "$(ls $PERM_LOCATION)
                    ;;
                *)
                    ;;
            esac
            if [ ! -z "$opts" ]; then
                COMPREPLY=( $(compgen -W "$opts" -- ${COMP_WORDS[COMP_CWORD]}) )
            fi
        fi
    fi
}

complete -F _manage manage

_proxy() {
    local kh
    kh="$HOME/.ssh/known_hosts"
    if [ -e "$kh" ]; then
        local cur opts
        if [ $COMP_CWORD -eq 1 ]; then
            opts=$(cat "$kh" | cut -d ":" -f 1 | grep "^\[" | grep "\]$" | sed "s/\[//g;s/\]//g")
            cur=${COMP_WORDS[COMP_CWORD]}
            COMPREPLY=( $(compgen -W "$opts" -- $cur) )
        fi
    fi
}

complete -F _proxy proxy

_notes() { 
    local cur files f filter fname ftype
    if [ $COMP_CWORD -eq 1 ]; then
        cur=${COMP_WORDS[COMP_CWORD]}
        COMPREPLY=( $(compgen -W "rm ls show edit" -- $cur) )
    else
        if [ $COMP_CWORD -eq 2 ]; then
            cur=${COMP_WORDS[1]}
            filter=""
            case $cur in
                "rm" | "show")
                    filter="-type f"
                    ;;
            esac
            files=""
            source $HOME/.local/bin/conf
            for f in $(find $NOTES_DIR/ $filter | sed "s#$NOTES_DIR/##g"); do
                files="$f $files"
            done
            files=$(echo $files | sed "s/ $//g") 
            COMPREPLY=( $(compgen -W "$files" -- ${COMP_WORDS[COMP_CWORD]}) )
        fi
    fi
}

complete -F _notes notes

_pkg-upload() {
    local opts cur
    opts=$(pkg-upload _list_)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _pkg-upload pkg-upload

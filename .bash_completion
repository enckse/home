#!/bin/bash

_totp() {
    local opts cur
    opts=$(totp list)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _totp totp

_aem() {
    local opts cur
    cur=${COMP_WORDS[COMP_CWORD]}
    if [ $COMP_CWORD -eq 1 ]; then
        opts=$(perl ~/.local/bin/aem.pl help)
        COMPREPLY=( $(compgen -W "$opts" -- $cur) )
    else
        if [ $COMP_CWORD -ge 2 ]; then
            cur=${COMP_WORDS[1]}
            opts=""
            case "$cur" in
                "repo-add")
                    if [ $COMP_CWORD -eq 2 ]; then
                        opts="vpr.db.tar.gz apr.db.tar.gz"
                    else
                        opts=$(ls | grep ".pkg.tar.zst")
                    fi
                    ;;
            esac
            if [ ! -z "$opts" ]; then
                 COMPREPLY=( $(compgen -W "$opts" -- ${COMP_WORDS[COMP_CWORD]}) )
            fi
        fi
    fi
}

complete -F _aem aem

_wiki() {
    local opts cur
    opts=$(find ~/store/config/notebook -name "*.md" -type f | cut -d "/" -f 7-)
    cur=${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=( $(compgen -W "$opts" -- $cur) )
}

complete -F _wiki wiki

#!/bin/bash
glint() {
    if command -v go &> /dev/null; then
        local f
        goimports -l . | grep -v bindata.go | sed 's/^/[goimports]    /g'
        revive ./... | sed 's/^/[revive]       /g'
        for f in $(find . -type f -name "*.go" -exec dirname {} \; | sort -u); do
            go vet $f | sed 's/^/[govet]        /g'
        done
        golangci-lint run
    fi
}

plint() {
    local p
    for p in pycodestyle pydocstyle pyflakes; do
        $p $(find . -type f -name "*.py") | sed "s/^/$p: /g"
    done
}

_vim_plugins() {
    for f in "vim-airline/vim-airline" "dense-analysis/ale"; do
        echo "$f"
        p="$HOME/.vim/pack/dist/start/"
        if [ ! -d $p ]; then
            mkdir -p $p
        fi
        p="$p"$(echo $f | cut -d "/" -f 2)
        if [ ! -d $p ]; then
            git clone "https://github.com/$f" $p
        fi
        git -C $p pull
    done
}

sys-upgrade() {
    local f p
    echo "-> update ports"
    sudo port selfupdate
    sudo port upgrade outdated
    echo "-> update rust"
    rustup update
    echo "-> update kitty"
    kitty-updater
    echo "-> cleanup ports"
    sudo port uninstall inactive
    sudo port reclaim
    echo "-> update vim plugins"
    _vim_plugins
    echo "-> setup defaults"
    if [ "$(which python)" == "/usr/bin/python" ]; then
        sudo port select --set python python39;
    fi
    which pycodestyle 2>&1 || sudo port select --set pycodestyle pycodestyle-py39
    which pydocstyle 2>&1 || sudo port select --set pydocstyle py39-pydocstyle
    which pyflakes 2>&1 || sudo port select --set pyflakes py39-pyflakes
}

#!/bin/bash
source $HOME/.bin/common
source $HOME/.bin/workspaces
STATS_ICO=$USER_TMP/system-icons
STAT_SECONDARY="secondary"

function i3-stat()
{
    PRIMARY=0
    IS_SECOND=$PRIMARY
    if [ ! -z $1 ]; then
        case $1 in
        $STAT_SECONDARY)
            IS_SECOND=1
            ;;
        esac
    fi

    i3status | while :
    do
        read line
        CUSTOM=""
        ADDED_ICOS=""
        if [ $IS_SECOND -eq $PRIMARY ]; then
            if [ -e $WORKPLACE_FILE ]; then
                touch $WORKPLACE_FILE
                CUSTOM=$(cat $WORKPLACE_FILE)
            fi
    
            if [ -e $DISPLAY_UN ]; then
                CUSTOM="$CUSTOM (unlocked)"
            fi
            if [ -e $DISPLAY_EN ]; then
                CUSTOM="$CUSTOM (running)"
            fi
    
            if [ ! -z "${CUSTOM// }" ]; then
                CUSTOM="$CUSTOM |"
            fi
    
            CUSTOM="$CUSTOM|"
            CUSTOM=$(echo "$CUSTOM" | sed "s/|  |/|/g" | sed "s/||/|/g")
        
            if [ -e $STATS_ICO ]; then
                ADDED_ICOS=$(cat $STATS_ICO)
                ADDED_ICOS="|$ADDED_ICOS"
            fi
            TOUCH=$(toggle-touchpad "query")
            if [ $TOUCH -eq 0 ]; then
                ADDED_ICOS="$ADDED_ICOS\xf0\x9f\x8c\x82"
            fi
        fi
        echo -e "$CUSTOM $line $ADDED_ICOS" || exit 1
    done
}

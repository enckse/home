#!/bin/bash
source $HOME/.bin/common
MUSIC=$HOME/.cache/music
MUSIC_FILE="$HOME_PERSONAL/music"
function create-list() {
    local idx chr cnt line
    idx=1
    cnt=$(cat $MUSIC_FILE | wc -l)
    while [ $idx -le $cnt ]; do
        line=$(cat $MUSIC_FILE | head -n $idx | tail -n 1)
        chr=$(echo "$line" | cut -c1 | tr '[:lower:]' '[:upper:]')"/"
        echo "$chr"
        echo "$chr$line/***"
        idx=$((idx+1))
    done
}
tmpfile=$USER_TMP/music.$(date +%s)
create-list | sort -u > $tmpfile
rsync -av --include-from $tmpfile --exclude="*" -e "ssh" "$BASE_SERVER:store/Home/Media/Music/" $MUSIC --delete-after --delete-excluded

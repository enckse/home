#!/bin/bash
source $HOME/.bin/common
SETUP="--install"

function sync-now()
{
    SYNC_TO="sync"
    echo "====================="
    echo "running "$(date +%Y-%m-%dT%H:%M:%S)
    echo "====================="
    echo "checked for connection...$available"
    available=$(test-ssh "$SYNC_TO")
    if [ $available -eq $IS_CONNECTED ]; then
        rsync -avzc --exclude "*.lock" --delete-after ${SYNCED_PATH} -e ssh $SYNC_TO:~/Sync/
    fi
}

function install()
{
    sudo systemctl enable $HOME/.bin/sys/sync.timer
    sudo systemctl start sync.timer
    sudo ln -s $HOME/.bin/sys/sync.service /etc/systemd/system/sync.service
}

case $1 in
    $SETUP)
        install
        ;;
    *)
        sync-now
        ;;
esac

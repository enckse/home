#!/bin/bash
source $HOME/.cache/pastebin.config

function check-value()
{
    if [ -z "$1" ]; then
        echo "$2 variable not set"
        exit -1
    fi
}

# Check local (not source controlled) values
check-value "$PASTE_API_TOKEN" "PASTE_API_TOKEN"
check-value "$PASTE_URL" "PASTE_URL"

INPUT="${1:-/proc/${$}/fd/0}"
data=$(cat $INPUT)
title=$(date +%Y-%m-%dT%H-%M-%S)-$(uuidgen)
if [ -z "$data" ]; then
    echo "no data"
    exit -1
fi

function do-paste()
{
    curl -s $PASTE_URL \
        -d api.token=$PASTE_API_TOKEN \
        -d content="$data" \
        -d title="$title" \
        --insecure
}

do-paste > /dev/null

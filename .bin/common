#!/bin/bash
# constants
READY="ready"
IS_CONNECTED=1
NOT_CONNECTED=0
RED_TEXT="\033[1;31m"
NORM_TEXT="\033[0m"
BASE_SERVER="blip"
GIT_PARTIAL_PATTERN="weechat|random_seed"

# standalone files/dirs
PERM_LOCATION=/opt/perm/
PERM_PERSONAL=personal
SSH_AUTH_TMP=/tmp/ssh-auth.sock

# home
USER_TMP=$HOME/.tmp
SYNCED_PATH=$HOME/.synced/
HOME_CONF=$HOME/.config/
HOME_CACHE=$HOME/.cache/

# perm
CHROOT_LOCATION=${PERM_LOCATION}chroot

# syncing
SYNCED_CONF=${SYNCED_PATH}/configs/
PRIV_CONF=${SYNCED_CONF}priv.aliases

# user temp
PROFILE_DEF=$USER_TMP/profile.next
DISPLAY_UN=$USER_TMP/display-unlocked
DISPLAY_EN=$USER_TMP/display-enabled
GIT_PARTIAL_TMP=$USER_TMP/git-partial
GIT_CHANGES=$USER_TMP/git.changes
SND_MUTE=$USER_TMP/.mute
PROFILE_TMP=$USER_TMP/.profile.synced.
MAIN_STATS=$USER_TMP/stats
USER_JOURNAL=$USER_TMP/journal.log

# checks
CHECK_STATUS=$USER_TMP/stat.
PERM_PUSH=${CHECK_STATUS}pushed
PERM_PULL=${CHECK_STATUS}pulled
USER_SYNC=${CHECK_STATUS}synced

# sbh
SBH_LOCK=$USER_TMP/.sbhlock
SBH_STORE=${HOME_CACHE}sbh/

function mute()
{
    pamixer -m
}

function enter-window-vals()
{
    local word window active
    word=$2
    window=0
    while [ $window -eq 0 ]; do
        echo "please activate the $1 window to enter the text into"
        sleep 3
        active=$(xdotool getactivewindow)
        xdotool search --class $1 | grep -q $active
        if [ $? -eq 0 ]; then
            window=1
        else
            echo "please select a $1 window"
        fi
    done
    xdotool type "$word"
    for i in ${@:3}; do
        xdotool key $i
    done
}

function test-ssh()
{
    local running
    running=$(ssh -o BatchMode=yes -o ConnectTimeout=5 $1 echo $READY 2>&1)
    if [[ "$running" == "$READY" ]]; then
        echo $IS_CONNECTED
    else
        echo $NOT_CONNECTED
    fi
}

function get-git-folders()
{
    local res f
    res=""
    for f in $(find $1 -type d | sort); do
        if [ ! -d "$f/.git" ]; then
            continue
        fi
        res=$res" "$f
    done
    echo $res
}

function get-workspace-objs()
{
    get-git-folders "$HOME/workspace/"
}

function get-perm-objs()
{
    get-git-folders "${PERM_LOCATION} -maxdepth 2"
}

function update-stat()
{
    touch $1.$(date +%Y-%m-%d)
}

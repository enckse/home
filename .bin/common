#!/bin/bash
USER_TMP=$HOME/.tmp
USER_CRYPT=$USER_TMP/crypt.img
USER_STATS_ON=$USER_TMP/system-stats-toggle
USER_TOUCH="$USER_CRYPT $USER_STATS_ON"
SYNCED_PATH="$HOME/.synced/"
SSH_SYNC_PATH=${SYNCED_PATH}ssh/
INSTALL_DIR="/opt/"
PROFILE_DEF="${USER_TMP}/profile.next"
SYNC_NOW="${USER_TMP}/sync.now"
TOUCHPAD_SETTING="${USER_TMP}/touchpad"
READY="ready"
IS_CONNECTED=1
NOT_CONNECTED=0
PROXY_PORT=60000
SYNC_JOURNAL_CATEGORY="syncing"
LOCK_JOURNAL_CATEGORY="locking"
ALL_JOURNAL_CATEGORIES="$SYNC_JOURNAL_CATEGORY $LOCK_JOURNAL_CATEGORY"

function toggle-touchpad()
{
    INPUT_ID=$(xinput | grep "ImPS/2" | sed -n -e 's/^.*id=//p' | sed -e "s/\s/ /g" | cut -d " " -f 1)
    IS_ENABLED=$(xinput list-props $INPUT_ID | grep "Device Enabled" | cut -d ":" -f 2)
    IS_ENABLED=$(echo $IS_ENABLED)
    if [ -z $1 ]; then
        if [ $IS_ENABLED -gt 0 ]; then
            touch $TOUCHPAD_SETTING
            IS_ENABLED=0
        else
            rm -f $TOUCHPAD_SETTING
            IS_ENABLED=1
        fi
        xinput set-prop $INPUT_ID "Device Enabled" $IS_ENABLED
    else
        echo $IS_ENABLED
    fi
}

function log-message()
{
    echo "$2" | systemd-cat -t "$1"
}

function test-ssh()
{
    running=$(ssh -o BatchMode=yes -o ConnectTimeout=5 $1 echo $READY 2>&1)
    if [[ "$running" == "$READY" ]]; then
        echo $IS_CONNECTED
    else
        echo $NOT_CONNECTED
    fi
}

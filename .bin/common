#!/bin/bash
USER_TMP=$HOME/.tmp
USER_CRYPT=$USER_TMP/crypt.img
SYNCED_PATH="$HOME/.synced/"
SSH_SYNC_PATH=${SYNCED_PATH}ssh/
PROFILE_DEF="${USER_TMP}/profile.next"
READY="ready"
IS_CONNECTED=1
NOT_CONNECTED=0
PROXY_PORT=60000
DISPLAY_UN=/tmp/display-unlocked
DISPLAY_EN=/tmp/display-enabled
WORKPLACE_WORKING=/tmp/working
CRYPT_MNT=/mnt/crypt
SSH_KEY_PATH=${CRYPT_MNT}/ssh/
TOUCHPAD_ON=0
LAST_TMP_HIT=$USER_TMP/last.tmp
DEFAULT_REFRESH=1000
URL_COMMON=$HOME/.cache/dmenu_urls
INDEX_EXT=".index"
DMENU_ENTRIES="$USER_TMP/dmenu_cache"
DEFAULT_PING_REFRESH=10000
DEFAULT_INTERRUPT_REFRESH=500
STATUS_WORKPLACE_KEY="workplace"
STATUS_LOCKING_KEY="locking"
STATUS_BACKLIGHT_KEY="backlight"
STATUS_TOUCHPAD_KEY="touchpad"
STATUS_PING_KEY="ping"

function call-status()
{
    signal-status $1 > /dev/null
}

function signal-status()
{
    for p in $(pidof python); do
        ps $p | grep "genericon" | grep -q "$1"
        if [ $? -eq 0 ]; then
            kill -SIGUSR1 $p 
        fi
    done
}

function toggle-touchpad()
{
    INPUT_ID=$(xinput | grep "ImPS/2" | sed -n -e 's/^.*id=//p' | sed -e "s/\s/ /g" | cut -d " " -f 1)
    IS_ENABLED=$(xinput list-props $INPUT_ID | grep "Device Enabled" | cut -d ":" -f 2)
    if [ -z $1 ]; then
        if [ $IS_ENABLED -gt $TOUCHPAD_ON ]; then
            IS_ENABLED=0
        else
            IS_ENABLED=1
        fi
        xinput set-prop $INPUT_ID "Device Enabled" $IS_ENABLED
        call-status "$STATUS_TOUCHPAD_KEY"
    else
        echo $IS_ENABLED
    fi
}

function test-ssh()
{
    running=$(ssh -o BatchMode=yes -o ConnectTimeout=5 $1 echo $READY 2>&1)
    if [[ "$running" == "$READY" ]]; then
        echo $IS_CONNECTED
    else
        echo $NOT_CONNECTED
    fi
}
